<!DOCTYPE html>
<html>
  <!-- Page Data -->
  <head>
    <title>Coaster Rankings</title>
    <link rel="stylesheet" type="text/css" href="mainpage.css">
    <link rel="stylesheet" type="text/css" href="rankings.css">
    <link rel="icon" type="image/x-icon" href="/images/Favicon.png">
  </head>
  <body>
    <!-- Header -->
    <div class="header" style="margin:0;">
      <!-- <h1 class="headertitle" style="margin:0;">Jake's Roller Coasters</h1>-->
      <img src="/images/RCITitle.png" alt="Roller.Coaster.Images" class="center">
    </div>
  
    <!-- Navigation Bar -->
    <div class="topnav" id="myTopnav" style="margin:0;">
      <a href="https://watkin81.github.io/index.html">Home</a>
      <a href="https://watkin81.github.io/rankings.html">Rankings and Data</a>
      <a href="https://watkin81.github.io/index.html">Coaster Images</a>
      <a href="https://www.instagram.com/roller.coaster.images/" target="_blank" rel="noopener noreferrer">Roller.Coaster.Images Instagram</a>
      <a href="https://docs.google.com/spreadsheets/d/1t3_wkdWKvjc4ShfH19wA3XxdOACtt6-elpsVk1Y9krs" target="_blank" rel="noopener noreferrer">The Official Coaster Nerd Spreadsheet</a>
      <a href="https://docs.google.com/document/d/1R9gMBCIvhuTBLrbh60jCBUDpgeWp7a6Lxy510fxzx-g" target="_blank" rel="noopener noreferrer">Coaster List Document</a>
    </div>
    
    <input type="text" id="coasterInput" onkeyup="searchFunction()" placeholder="Search for coasters..">
    
    <br>
    <p id="coasternames"></p>
    <div id="coasterTable">
    </div>
    
    <script>
function searchFunction() {
  // Declare variables
  var input, filter, table, tr, td, i, txtValue;
  input = document.getElementById("coasterInput");
  filter = input.value.toUpperCase();
  table = document.getElementById("coasterTable");
  tr = table.getElementsByTagName("tr");

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[1];
    if (td) {
      txtValue = td.textContent || td.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }
  }
}
</script>
    
    <!--<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.min.js"></script>-->
    <script type="text/javascript" src="https://unpkg.com/papaparse@5.3.2/papaparse.min.js" integrity="sha384-6kRQDsV2kVYRSENnw7WnekWKCx8/Lmv7rFKpDuR2AoIbjlBShlYcs3x0QlE3kuRh" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var public_spreadsheet_url = 'https://docs.google.com/spreadsheets/d/1t3_wkdWKvjc4ShfH19wA3XxdOACtt6-elpsVk1Y9krs/pub?output=csv';

      function init() {
        Papa.parse(public_spreadsheet_url, {
          download: true,
          header: true,
          complete: showInfo,
          complete: makeTable
        })
      }

      window.addEventListener('DOMContentLoaded', init)

      function showInfo(results) {
        /* var data = results.data

        alert("Successfully processed " + data.length + " rows!") //temp alert
        var i = 0;
        let coasternamelist = "";
        while (i < data.length) {
          text2add = data[i].COASTER;
          coasternamelist = coasternamelist.concat(", ", text2add);
          i++;
        }
        document.getElementById("coasternames").innerHTML = "<strong>Coaster Names:</strong> " + coasternamelist;
          //[ data[0].COASTER, data[1].COASTER, data[2].COASTER ].join(", "); will use instead of concat after making table
        console.log(data);
        //console.log(coasternamelist); */
      }
      
      function makeTable(results) {
        var data = results.data
        const newTable = document.createElement("table");
        newTable.innerHTML = "<thead><th>Rank</th><th>Coaster</th><th>Park</th><th>Manufacturer</th></thead>";
        var j = 0;
        while (j < data.length){
          const newRow = document.createElement("tr");
          const tdRank = document.createElement("td");
          const tdCoaster = document.createElement("td");
          const tdPark = document.createElement("td");
          const tdManu = document.createElement("td");
          tdRank.textContent = data[j].RANK;
          tdCoaster.textContent = data[j].COASTER;
          tdPark.textContent = data[j].PARK;    
          tdManu.textContent = data[j].MANUFACTURER;
          newRow.appendChild(tdRank);
          newRow.appendChild(tdCoaster);
          newRow.appendChild(tdPark);
          newRow.appendChild(tdManu);
          newTable.appendChild(newRow);
          j++;
        }

        const coasterTable = document.getElementById('coasterTable');
        coasterTable.appendChild(newTable);
      }
        
      document.write("spreadsheet link: <a target='_new' href='" + public_spreadsheet_url + "'>" + public_spreadsheet_url + "</a>");        
    </script>
  </body>
</html>
